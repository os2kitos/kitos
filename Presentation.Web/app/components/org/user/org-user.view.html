<div search-box data-paging="pagination"></div>
<div class="searchbox-wrapper">
    <a class="excel-icon" data-ng-href="{{csvUrl}}">
        <img src="../../Images/excel.png" alt="Hent excelark" width="25">
    </a>
</div>

<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">
            <span class="glyphicon glyphicon-user"></span> {{ currentUser.currentOrganizationName}}
        </h3>
    </div>

    <table class="table table-condensed table-striped">
        <thead>
            <tr>
                <th width="200">
                    Navn
                    <button data-order-by="'Name'" data-paging="pagination"></button>
                </th>
                <th width="200">
                    Email
                    <button data-order-by="'Email'" data-paging="pagination"></button>
                </th>
                <th width="180">
                    Default org.enhed
                    <button data-order-by="'DefaultOrganizationUnit.Name'" data-paging="pagination"></button>
                </th>
                <th width="80">
                    Advis
                    <button data-order-by="'LastAdvisDate'" data-paging="pagination"></button>
                </th>
                <th width="180">
                    Oprettet af
                    <button data-order-by="'ObjectOwner.Name'" data-paging="pagination"></button>
                </th>
                <th width="160">
                    <select data-ng-model="chosenModule" ng-change="getRightsForModule(chosenModule)">
                        <option value="0">Vælg modul</option>
                        <option value="1">Organisation</option>
                        <option value="2">IT Projekter</option>
                        <option value="3">IT Systemer</option>
                        <option value="4">IT Kontrakter</option>
                    </select>
                </th>
                <th width="160" class="text-left">
                    Rolle
                </th>
                <th width="63">
                    <!-- Control -->
                </th>
            </tr>
        </thead>
        <tbody>
            <tr data-ng-repeat="user in users">
                <td>{{user.fullName}}</td>
                <td>{{user.email}} </td>
                <td>{{user.organizationRights.defaultOrgUnitName == null ? rootUnitName : user.defaultOrganizationUnitName}}</td>
                <td>
                    <button type="button" data-ng-if="user.lastAdvisDate === null" class="btn btn-success btn-xs btn-block" data-ng-click="sendAdvis(user, false)" data-ng-disabled="!user.canBeEdited">
                        Send Advis
                    </button>
                    <button type="button" data-ng-if="user.lastAdvisDate !== null" class="btn btn-warning btn-xs btn-block" data-ng-click="sendAdvis(user, true)" data-ng-disabled="!user.canBeEdited">
                        {{user.lastAdvisDate | date:'dd-MM-yy'}}
                    </button>
                </td>
                <td>{{user.objectOwnerName}} {{user.objectOwnerLastName}}</td>
                <td colspan="2">
                    <table data-ng-if="user.rights" class="full-width table table-condensed table-striped table-no-margin text-left">
                        <tbody>
                            <tr data-ng-repeat="right in user.rights">
                                <td class="text-left">
                                    {{right.objectName}}
                                </td>
                                <td class="text-left">
                                    {{right.roleName}} ({{right.roleHasWriteAccess && "S" || "L" }})
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </td>
                <td class="text-right col-md-1">
                    <button type="button" class="btn btn-info btn-xs" data-ng-click="editUser(user)" data-ng-disabled="!user.canBeEdited">
                        <span class="glyphicon glyphicon-pencil"></span>
                    </button>
                    <button class="btn btn-danger btn-xs" data-ng-click="deleteOrgRole(user)" data-ng-disabled="!user.canBeEdited">
                        <span class="glyphicon glyphicon-trash"></span>
                    </button>
                </td>
            </tr>
        </tbody>

        <tfoot data-ng-show="totalCount > users.length">
            <tr>
                <td colspan="9" class="text-center">
                    <span data-pagination-buttons="pagination" data-pagination-total-count="totalCount"></span>
                </td>
            </tr>
        </tfoot>
    </table>
</div>
